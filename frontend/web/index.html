<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Проверки — Web</title>

  <link rel="stylesheet" href="./assets/css/base.css" />
  <link rel="stylesheet" href="./assets/css/layout.css" />
  <link rel="stylesheet" href="./assets/css/components.css" />
  <link rel="stylesheet" href="./assets/css/modal.css" />
  <link rel="stylesheet" href="./assets/css/inspection-window.css" />
</head>

<body>
  <div id="appRoot" aria-live="polite"></div>

  <script>
    (async function bootstrapPage() {
      const appRoot = document.getElementById("appRoot");
      const fragments = [
        "./partials/app-shell.html",
        "./partials/check-modal.html",
        "./partials/people-modals.html",
      ];

      async function loadFragment(path) {
        const response = await fetch(path, { cache: "no-cache" });
        if (!response.ok) {
          throw new Error(`Не удалось загрузить фрагмент: ${path}`);
        }
        return response.text();
      }

      function appendScript(src) {
        return new Promise((resolve, reject) => {
          const script = document.createElement("script");
          script.src = src;
          script.onload = resolve;
          script.onerror = reject;
          document.body.appendChild(script);
        });
      }

      try {
        const html = await Promise.all(fragments.map(loadFragment));
        appRoot.innerHTML = html.join("\n");

        const scripts = [
          "./assets/js/app.js",
          "./assets/js/verification-areas.js",
          "./assets/js/people-modal.js",
          "./assets/js/checks.js",
          "./assets/js/new-check-modal.js",
          "./assets/js/inspection-window.js",
        ];

        for (const src of scripts) {
          await appendScript(src);
        }

        if (window.AppRouter?.init) {
          window.AppRouter.init();
        }
      } catch (error) {
        console.error(error);
        appRoot.textContent = "Ошибка загрузки интерфейса.";
      }
    })();
  </script>
</body>
</html>
